<ng-container *ngVar="mediaList$ | async as mediaList">
  <ds-themed-loading
    *ngIf="isLoading"
    message="{{ 'loading.default' | translate }}"
    [showMessage]="false"
  ></ds-themed-loading>
  <div class="media-viewer" *ngIf="!isLoading">
    <ng-container *ngIf="mediaList.length > 0; else showThumbnail">
      <ng-container *ngVar="mediaOptions.video && ['audio', 'video'].includes(mediaList[0]?.format) as showVideo">
        <ng-container *ngVar="mediaOptions.image && mediaList[0]?.format === 'image' as showImage">
          <ds-themed-media-viewer-video *ngIf="showVideo" [medias]="mediaList" [captions]="captions$ | async"></ds-themed-media-viewer-video>
          <ds-themed-media-viewer-image *ngIf="showImage" [images]="mediaList"></ds-themed-media-viewer-image>
          <ng-container *ngIf="showImage || showVideo; else viewPdf"></ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  </div>
  <ng-template #viewPdf>
    <ng-container *ngIf="viewPdfEnabled; else showThumbnail">
      <a
        *ngIf="viewPdfEnabled"
        (click)="showPdfViewer(mediaList[0])">
          <img class="pdf-viewer-thumbnail" src="{{ (thumbnailsRD$ | async)?.payload?.page[0]?._links.content.href }}"/>
          <p class="pdf-viewer-thumbnail-text">{{ mediaList[0].bitstream._name }} ({{ (mediaList[0].bitstream.sizeBytes) | dsFileSize }})</p>
      </a>
      <div *ngIf="viewPdfEnabled">
        <ul id="viewer-links">
          <ng-container *ngFor="let media of mediaList; index as i">
              <li *ngIf="(i > 0) && media.type==='pdf'" [class]="media.canDownload ? 'clickable' : 'non-clickable'">
                <i *ngIf="!media.canDownload" class="fas fa-lock" title="Restricted">&nbsp;</i>
                <i *ngIf="media.canDownload" class="fas fa-eye" title="View">&nbsp;</i>
                <a (click)="showPdfViewer(media)">{{ media.bitstream._name }}</a>
              </li>
          </ng-container>
        </ul>
      </div>      
      <div *ngIf="pdflink" id="pdf-viewer-wrapper" class="pdf-viewer-wrapper">
        <ds-media-viewer-pdf (close)="handleClose()" id="pdf-viewer-el" class="pdf-viewer-wrapper" [pdf]="pdfblob" [src]="pdflink"></ds-media-viewer-pdf>
      </div>
    </ng-container>
  </ng-template>
  <ng-template #showThumbnail>
    <ds-themed-media-viewer-image *ngIf="mediaOptions.image && mediaOptions.video"
      [image]="(thumbnailsRD$ | async)?.payload?.page[0]?._links.content.href || thumbnailPlaceholder"
      [preview]="false"
    ></ds-themed-media-viewer-image>
    <ds-thumbnail *ngIf="!(mediaOptions.image && mediaOptions.video)"
                  [thumbnail]="(thumbnailsRD$ | async)?.payload?.page[0]">
    </ds-thumbnail>
  </ng-template>
</ng-container>
